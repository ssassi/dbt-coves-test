name: Build and Test

on: ["push", "pull_request"]

jobs:
  build:
    name: Main CI
    runs-on: ubuntu-latest

    steps:
      - name: Checkout branch
        uses: actions/checkout@v2

    - name: dbt-run
        uses: datacoves/dbt-coves-action@main
        with:
          command: "dbt run"
        env:
          DBT_USER: ${{ secrets.DBT_USER }}
          DBT_PASSWORD: ${{ secrets.DBT_PASSWORD }}
          DBT_SNOWFLAKE_ACCOUNT: ${{ secrets.DBT_SNOWFLAKE_ACCOUNT }}
          DBT_SNOWFLAKE_ROLE: ${{ secrets.DBT_SNOWFLAKE_ROLE }}
          DBT_SNOWFLAKE_WAREHOUSE: ${{ secrets.DBT_SNOWFLAKE_WAREHOUSE }}
          DBT_TEST_DATABASE: ${{ secrets.DBT_TEST_DATABASE }}
          DBT_PROFILES_DIR: .config
